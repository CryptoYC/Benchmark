##  一、 概述
Zilliqa是第一个使用分片方案(Sharding)的公链平台。它一个全新的区块链平台通过实施分片技术试图解决拓展性问题。Zilliqa出自新加坡国立大学的一个基于技术白皮书的研发项目。对白皮书的进一步调研与实验演化成了Zilliqa项目。

##  二、分析

### (一) 测试说明

我们的在AWS上部署了若干个Kubernetes节点，用以模拟Zilliqa网络的环境，具体测试环境如下：
![env](media/env.png)

### (二) 共识

Zilliqa使用了独特的共识算法：实际拜占庭容错(Pratical Byzantine Tolerance)。PBFT是一种非常安全的共识机制，它有着一部分节点是怀有敌意的假设。因此，每个节点必须独立的验证所有交易并且结果在所有节点中分享，随着共识在大部分节点中完成。在PBFT中，共识组内的所有节点都按顺序排列，它有一个主节点（或领导者），其他节点称为备份节点。 
每轮PBFT都有三个阶段，如下所述：
- 预准备阶段: 在这个阶段，领导者宣布该小组将应该达成一致共识的下一个记录 
- 准备阶段：在接收到预先准备消息后，每个节点验证其正确性并将准备消息多播给所有其他节点
- 提交阶段：在收到超过2/3*n准备消息时，节点向组播组发送提交消息。最后，节点等待超过2/3*n的提交消息，以确保有足够数量的节点做出相同的决定。 因此，所有诚实的节点都接受相同的有效记录。
Zilliqa用PBFT来做共识，主要考虑是：
1、它不是计算资源密集型的，比PoW耗能少
2、效率更高，因为它可以利用一个小的共识组
3、它不像基于PoW的共识机制，通常需要至少6个确认，pBFT的共识协议不会发生临时分叉，所以不需要确认，赋予了交易最终性。
正是因为PoW+pBFT的搭配方式在保证Zilliqa网络安全性、降低能耗的同时，还有效利用了Zilliqa的分片技术，在相对小的分组内达成共识，明显提升了网络效率，所以这是最适合Zilliqa的共识方式。

### (三) 安全

通过Benchmark公链测试工具，对Zilliqa进行一系列安全测试，包括DDos攻击、长程攻击、短程攻击、网络分裂攻击等，我们的测试方法如下:

1.  建立Zilliqa测试网；

2.  发送RPC，让测试网部分节点对其他节点发起攻击；

3.  得到测试结果。

| 方案         | 结果   | 备注                                                                     |
|--------------|--------|--------------------------------------------------------------------------|
| DDoS攻击     | 不通过   | 以大量的通信量冲击网络，使得所有可用网络资源都被消耗殆尽                 |
| 长程攻击     | 不通过   | 攻击者创建了一条从创世区块开始的长区块链分支，并试图替换掉当前的合法主链 |
| 短程攻击     | 通过   | 攻击者篡改最近几个区块的数据                                             |
| 网络分裂攻击 | 不通过 | 把网络分成两个或多个部分，使得在较小的链上进行的任何重复交易都将丢失     |

从DDos攻击测试结果可知，攻击者可以向全部或51％的Zilliqa节点发送DDoS攻击，Zilliqa网络不能正常使用。

从长程攻击测试结果可知，攻击者可以创建了一条从创世区块开始的长区块链分支，并换掉当前的合法主链。

从短程攻击测试结果可知，攻击者无法篡改Zilliqa网络最近几个区块的数据，以替换掉当前的合法主链。

从网络分裂攻击测试结果可知，在发生网络分裂攻击后，在网络恢复正常之前，在较小的链上进行的任何重复交易都将丢失。


### (四) 性能

通过Benchmark公链测试工具，对Zilliqa进行性能测试，我们的测试方法如下：

1.  建立Zilliqa单分片的测试网；

2.  发送RPC，让测试网部分节点发起交易（每秒N笔交易，线性增长）；

3.  节点检测交易同步的时间，直到检测到超过一定时间（一般是出块时间）。

| 方案         | TPS | 备注                              |
|--------------|-----|-----------------------------------|
| 理想网络情况 | 412   | 单机虚拟机网络，无限网络连接      |
| 正常网络情况 | 122   | 分布全球的100个节点，正常网络连接 |
| 恶劣网络情况 | 11   |   |

### (五) 技术创新

Zilliqa带来的突破性的技术是其他区块链项目没有达到的分片技术。分片的概念源自于分布式数据库，但是在Zilliqa之前从未把分片技术引入公有区块链中。分片的思想是把网络中的节点分成一个更小的集合或更小的委员会(被称作碎片)，以此来平行的处理交易。每一个Shard碎片有它自己的迷你区块并且和其他碎片并行处理交易直至最终结果完成。

Zilliqa使用工作量证明机制(Proof of Work)来维护网络。然而，这是一种大幅度修改版本的工作量证明机制。在比特币和以太坊中，矿工使用工作量证明机制建立身份。PBFT中，却是用来建立共识。通常来说，POW是能源耗费的因为所有的矿工要去竞争，通过解决非常复杂的数学问题，第一个解答出来问题的获得奖励。这种机制保障了网络的安全但是非常浪费能源。

### (六) 智能合约

Zilliqa包含智能合约层面。智能合约层将使用Scilla语言，一种类似Solidary的语言。Scilla语言让开发者更加容易开发并且把应用从以太迁移至Zilliqa。智能合约是非图灵完备的(Non-Turing Complete)。非图灵完备有优点也有缺点。优点是用非图灵完备语言写的智能合约相比于图灵完备语言更安全更稳定。缺点是非图灵完备语言缺乏灵活性在某些情况下受制。

### (七) 代码

1.  代码概况

Zilliqa的主要Github仓库的具体数据如下:

| repository      | commit | watch | star | fork | issue |
|-----------------|--------|-------|------|------|-------|
|Zilliqa|7358|122|818|181|63|
|scilla|921|25|120|36|58|
|Zilliqa-JavaScript-Library|526|16|53|23|2|
|nucleus-wallet|159|11|5|3|0|
|savant-ide|255|8|14|9|10|

2.  代码更新

根据Zilliqa的Zilliqa的Github commits数据，得到Zilliqa的代码更新情况，如下:

![frequency](media/frequency.png)

3.  代码重复



###  (七) 经济模型

ZIL是Zilliqa区块链背后的驱动力，通过向网络节点支付费用来消费ZIL。为了在Zilliqa区块链上创建ZIL或其他未来代币，必须在其钱包中持有ZIL。
- 发行机制
代币总量210亿，目前已发行126亿，剩余84亿将通过挖矿产生；不增发
40%挖矿奖励将随着时间的推移在10年内递减（前4年挖约80%，后6年挖约20%）
- 代币分配
40%用于挖矿，30%用于社区公售，团队、顾问、早期开发人员各占：5%、3%、12%，剩余的10%用于安全性投入。


##  总结
Zilliqa采用为网络分片技术、POW+PBFT共识机制和智能合约语言Scilla，为高吞吐量的应用程序提供运行平台的新一代公链，技术亮点突出。有一定创新，但应用场景不明确。 